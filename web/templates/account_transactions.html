	<link rel="stylesheet" media="screen" href="stylesheets/style.css" />
<link rel="stylesheet" media="screen" href="stylesheets/font-awesome.min.css" />  

<script type="text/javascript" src="javascripts/jquery-1.11.1.js"></script>
<script type="text/javascript" src="javascripts/jquery-migrate-1.2.1.js"></script>
<script type="text/javascript" src="javascripts/jquery-ui.min.js"></script> 
<script type="text/javascript" src="javascripts/general.js"></script>
<script type="text/javascript" src="javascripts/jquery.cookie.js"></script>
<script type="text/javascript" src="javascripts/plugins/jquery.alerts.js"></script>
<script type="text/javascript" src="javascripts/index.js"></script>	
<link href="stylesheets/buttons.dataTables.min.css" type="text/css" rel="stylesheet">
<script src="javascripts/jquery.dataTables.min.js" language="javascript" type="text/javascript"></script>
<script src="javascripts/dataTables.buttons.min.js" language="javascript" type="text/javascript"></script> 

	<style>
	   .effect  { border: 4px solid rgb(255, 255, 255); }

	   .people	h3 {background: none repeat scroll 0% 0% #a6d4e6; color: white; margin-top: -20px; margin-left: -1px; padding-top: 5px; padding-bottom: 5px;}
	  .userModal {height: auto; }
	  .inactiveRow{background: #D3CDCD}
	  .inactiveRow:hover{background: #D3CDCD}
	  #userModal{height:auto;}
	  .maincontent .left{overflow: hidden;}	
	  
	  .form_default fieldset{
			background-color: #EEEEEE;
		}
		.add_plus_icon{
			font-size: 18px;
		    position: relative;
		    top: 3px;
		    left: 3px;
		    color: #555;
		}
		#channelModal th{
			color: #666;
		}
		
		#channelAdd:hover{
			color:#fff;
		}	 
	  
	</style>



<div style='padding-bottom: 40px;'>
<div style='width:20%;float:left;'>
<button type='button' class='gray_button btn btn-xs' onclick="location.href='deposit_form.html'"  style="cursor: pointer;background-color: #075192;border-color: #075192;" id="deposit" title="Deposit">TO DEPOSIT &nbsp;&nbsp;
</button>
<button type='button' class='gray_button btn btn-xs' onclick="location.href='withdraw_form.html'"  style="cursor: pointer;background-color: #075192;border-color: #075192;" id="withdraw" title="Withdraw">TO WITHDRAW
			&nbsp;&nbsp;
</button>
   <div style="position: relative;margin-left:497px;color:white;font-size:30px;margin-top:-11px;"> CUSTOMERS</div>

</div>


<div class="form_default" style='width:80%;float:right;'>

			
</div>
</div>


	 
	<table cellpadding="0" cellspacing="0" border="0" class="dyntable" id="channel_list">
	  <thead>
	    <tr>
	      <th class="head0">Customer Name</th>
	        <th class="head1">Account Number</th>
	         <th class="head1">Account Type</th>
	      <th class="head0">Address</th>
	      <th class="head0">Balance</th>
	    </tr>
	  </thead>
	  <tbody>
	    
	  </tbody>
	</table>
	<div style="display:none;overflow: hidden;height:auto" class="userModal" id="channelModal">
		<div class="form_default" >
				<div style="border: 1px solid #a6d4e6; float: left;margin: 20px; height: auto; width: 420px;" class="effect people"> 
					<h3 style="width:420px;text-align:center;color: #065996;"><span style="">Channel Details</span></h3> <br>

					<table class="table table-striped" style="margin-top: -23px;">
						<tr>
							<th>
								<div style="width:175px;float:left;font-weight:bold;text-align: right;">Name </div>
							</th>
							<td>
								<span id= "name" style="text-align: left;" > </span>
							</td>
						</tr>
						<tr>
							<th>		
								<div style="width:175px;float:left;font-weight:bold;text-align: right;">Street </div> 
							</th>
							<td>
								<span id="street" style="text-align: left;"> </span>
							</td>
						</tr>
						<tr>
							<th>		
								<div style="width:175px;float:left;font-weight:bold;text-align: right;">Area </div> 
							</th>
							<td>
								<span id="area" style="text-align: left;"> </span>
							</td>
						</tr>
						<tr>
							<th>		
								<div style="width:175px;float:left;font-weight:bold;text-align: right;">Landmark </div> 
							</th>
							<td>
								<span id="landmark" style="text-align: left;"> </span>
							</td>
						</tr>
						<tr>
							<th>		
								<div style="width:175px;float:left;font-weight:bold;text-align: right;">City </div> 
							</th>
							<td>
								<span id="city" style="text-align: left;"> </span>
							</td>
						</tr>
						<tr>
							<th>			
								<div style="width:175px;float:left;font-weight:bold;text-align: right;">State</div> 
							</th>
							<td>
								<span id="state" style="text-align: left;"> </span>
							</td>
						</tr>
						<tr>
							<th>		
								<div style="width:175px;float:left;font-weight:bold;text-align: right;">PinCode</div> 
							</th>
							<td>
								<span id="pincode" style="text-align: left;"> </span>
							</td>
						</tr>		
					</table>
					
				</div>
	    </div><!--form-->           
	</div>        

	<script type="text/javascript">	
	var table = $('#channel_list').dataTable({
	   "iDisplayLength": 25,
	   "aLengthMenu": [[25, 50, 75, 100, -1], [25, 50, 75, 100, "All"]],
	   'bAutoWidth': false,
	   "paging": true,
       "pagingType": 'full_numbers'
	});

	$(document).ready(function() {
		console.log("i am herrrrrrrrrrrr")
		channel = $("#channel").val();
		url = "customer_details"
		
		$.ajax({
		   dataType: 'JSON',
		   url: url,
		   success: function(json) {
		   console.log("JSONNON"+JSON.stringify(json))
		   for (hash in json) {
		   	     console.log("Hasssssssssh"+JSON.stringify(hash))
		        for (i = 0; i < json[hash].length; i++) {		 
		                console.log("json hash value"+json[hash][i])       		
		        		var view = "<a data-action='view' id='e_"+json[hash][i]['_id']+"' title='View spot_type' style='cursor:pointer;'>"+json[hash][i]['name']+"</a>";
		        		var actionMessg = "<a data-action='edit' id='e_"+json[hash][i]['_id']+"' style='cursor:pointer;font-size:16px;'><i class='fa fa-edit' title='Edit Channel' style='margin-right:10px;'></i></a><a  data-action='del' id='d_"+json[hash][i]['_id']+"' style='cursor:pointer;font-size:16px;'><i class='fa fa-trash text-danger' title='Delete Channel'></i></a>";
		        		var correct_msg = "<i class='fa fa-check' aria-hidden='true' style='color:green'></i>"
		        		var wrong_msg = "<i class='fa fa-ban' aria-hidden='true' style='color:red'></i>"
		        		if("customer_name" in json[hash][i]){
		        		var customer_name =  json[hash][i]['customer_name']
		             	}
                        var acc_type =  json[hash][i]['type']
                        var acc_no = 	json[hash][i]['acc_no']
                        var address = json[hash][i]['address']
					    var Balance = json[hash][i]['balance'] 
					     
					    
		                    table.fnAddData([customer_name  ||"",acc_type || " ",acc_no||"",address ||" ", Balance]);
		                
		                
		                
		            }
		       }
			     
			}
		});
		
  function deleteChannel(id){
			//var id = jQuery('#id').val();
			if(id!=""){
							jConfirm('Do you want to delete this channel?',"Channel",function(response){
								if(response){
									jQuery.ajax({
										
										url : "/channels/"+id,
										type : 'DELETE',
										dataType : "json",
										success : function(data) {
											jQuery('#main').load("settings/channel_list.html");
									 	return false;
											//jQuery('.comboBox option').remove();
											//loadList();
											/*jQuery('.cancel').css('display','inline');
											jQuery('#saveChannel').css('display','inline');
											jQuery('#updateChannel').css('display','none');
											jQuery('#deleteChannel').css('display','none');
											jQuery('#cancelChannel').css('display','none');
											jQuery('#id').val("");*/
										},
										error: function(xhr, status, text) {
				                            var response = $.parseJSON(xhr.responseText);
				                            var err = response.errors;
				
				                         //   if (response) {
				                       if(err.toString()=='session_expired'){
				        	window.location.href= "index.html";
				        } 
				        else{  	
				                               jAlert(err.toString());
				                            }
				                        }
									});
								}
							});
			}else{
				jQuery('#name').addClass("error");
				var msg = "Please select a value from dropdown box";
				var position = "top-right";
				var scrollpos = jQuery(document).scrollTop();
				if(scrollpos < 50) position = "customtop-right";
				jQuery.jGrowl(msg, { life: 5000, position: position});
				return false;
			}
		}

     $('#deleteChannel').click(function(){
	var id = jQuery('#id').val();
	var identity = jQuery('#identity').val();
	var chanl_name = $("#channelSelect").find('option:selected').text();
			
	jQuery.ajax({
		url : "/channel-data?channel_id="+identity,
		type : 'GET',		
		success : function(resdata) {
			console.log("dash board dataaaaaaaaaaaa")
			if(resdata['dashboard-data']!=undefined){
			 var data = resdata['dashboard-data'];
			 var prog = 0;
			 var cust = 0;
			 var orders = 0;
			 var agency = 0;
			 var log = 0;
			 var commercials = 0;
			 var users = 0;
			 if(data.progCount!=undefined)
			  prog = data.progCount;
			 			
			 if(data.customerCount!=undefined)
			  cust = data.customerCount;
			 		 

			 if(data.orderCount!=undefined)
			  orders = data.orderCount;
			  
			 
			 if(data.agencyCount!=undefined)
			 agency = data.agencyCount;
			 
			 if(data.preLogCount!=undefined)
			 log =  data.preLogCount;
			
			 
			 if(data.commercialsCount!=undefined)
			 commercials = data.commercialsCount;
			 

			 if(data.usersCount!=undefined)
			  users = data.usersCount;
			 
			 

			 flag = true;
			 if(prog==0 && cust==0 && orders==0 && agency==0 && commercials==0 && users==0){ 
				 flag = false;
				 console.log("no data")
			 }else{
				 console.log("data exists");
			 }

            
			 if(flag){
			 	var channel_name = $("#channelSelect").find('option:selected').text();  
				 confirmMsg = "<b>Data exists for this channel: " + chanl_name + "</b><br/>";
				 if(prog!=0){
					 confirmMsg = confirmMsg +  "Programs: "+prog+ "<br/>";
				 }
				 if(cust!=0){
					 confirmMsg = confirmMsg +  "Customers: "+cust+ "<br/>";
				 }
				 if(orders!=0){
					 confirmMsg = confirmMsg +  "Orders: "+orders+ "<br/>";
				 }
				 if(agency!=0){
					 confirmMsg = confirmMsg +  "Agency: "+agency+ "<br/>";
				 }
				 if(commercials!=0){
					 confirmMsg = confirmMsg +  "Commercials: "+commercials+ "<br/>";
				 }
				 if(users!=0){
					 confirmMsg = confirmMsg +  "Users: "+users+ "<br/>";
				 }

				 console.log("confirmMsg::::::"+confirmMsg)
				
				 jConfirm(confirmMsg,"Channel Delete",function(response){
					 if(response){
							deleteChannel();		
						}
				 })
				}else{
					deleteChannel();
				}
			   }else{
			   	//deleteChannel();
			   }
			 },

		
		error: function(xhr, status, text) {
				       var response = $.parseJSON(xhr.responseText);
				       var err = response.errors;
				
				     //   if (response) {
				    if(err.toString()=='session_expired'){
				        	window.location.href= "index.html";
				        } 
				        else{ 	
				            jAlert(err.toString());
				        }
		}
	})
	
});


		jQuery('#channelAdd').click(function(event){  
			event.preventDefault();
			//jQuery.ajax({url:"/user/create",success:function(data){jQuery('#main').html(data);}});  
			jQuery('#main').load("settings/channel_add.html");
		});

	  /* Table initialisation */  
	   jQuery('#channel_list').on("mouseover","tr",function(event){
		  	jQuery(this).css({background:"#C8D9E8"});	  	
	   });
	   jQuery('#channel_list').on("mouseout","tr",function(event){
		  	jQuery(this).css({background:"#ffffff"}); 
	 	});
	   
	  /* Highlight tab menu */
	    jQuery('ul#usertabmenu > li.current').removeClass('current');            
	  	jQuery('#usertabmenu_user_list').addClass('current');
	  	
	    /* Edit & Delete call */	
	  	jQuery('#channel_list').on("click","a",function(event){  
	  		var id = jQuery(this).attr('id').split('_')[1];
	  		console.log("IDDDD"+id)
		    var da=jQuery(this).attr('data-action');
		    if(da=='edit') {
		    	jQuery.ajax({url:"settings/channel_edit.html",success:function(data){jQuery('#main').html(data);}});
		    	$.cookie("channelId", id);
			  }
			  else	if(da=='view') {
				  custUrl = "/channels/"+id;
				  custType = "GET";				  
				  jQuery.ajax({					  
				    	type:custType,
			  			url:custUrl,
			  			success:function(data){
			  				console.log("DATAAAAA"+JSON.stringify(data))
			  				var channel = data['channel'];	
                            console.log("single chaeeeeeee"+JSON.stringify(channel))
                            console.log("nameeeeee"+channel["name"])
			  				$("#name").html("");
			  				$("#name").html(channel["name"]);
			  				$("#street").html("");
			  				chanl_adress = channel["address"]
			  				if(chanl_adress != undefined){
			  				    $("#street").html(chanl_adress.street);
			  				    $("#landmark").html("");
				  				$("#landmark").html(chanl_adress.landmark);
				  				$("#area").html("");
				  				$("#area").html(chanl_adress.area);
				  				$("#city").html("");
				  				$("#city").html(chanl_adress.city);
				  				$("#state").html("");
				  				$("#state").html(chanl_adress.state);
				  				$("#pincode").html("");
				  				$("#pincode").html(chanl_adress.pincode);
			  			    } 
			  				
			  			
			  				
			  				showQEDialogId("channelModal","Channel Details");
			  				
			  				
			  			}  			
			  		});	
			  }
			  else if (da=='del'){
				 deleteChannel(id);
	  		  }		  	
		 
	  
	  	});
	});
	</script>